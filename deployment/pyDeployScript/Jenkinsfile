// Jenkisfile (Declarative Pipeline)

// Global Variable

pipeline {
    agent {
        node {
            label 'deploy_py'
        }
    }

    options {
        buildDiscarder(logRotator(numToKeepStr: '5'))
        timestamps()
    }

    parameters {
        string(name: "BRANCH", defaultValue: "master", description: "")
        string(name: "VM_NAME", defaultValue: "", description: "Name of the VM. Enter the vm name without domaain. </b>For Example:</b> Machine host is 'myd-hvm01120.hpeswlab.net' so the VM_NAME will be 'myd-hvm01120'")
        choice(name: "MODE", choices: [ "resnapshot", "uninstall"], description: "Restart: Restart the machine. \n Revert: Revert to snapshot and restart the machine.")
        string(name: "LABEL", defaultValue: "UFT_2022_0", description: "The label name is used to read the xml file. ")
        string(name: "BUILD_VERSION", defaultValue: "2022.0.0.24", description: "The label name is used to read the xml file. ")
        // string(name: "", defaultValue: "", description: "")
    }

    stages {
        stage("Executing Action") {
            steps {
      bat """
set VM_NAME=${params.VM_NAME}
set MODE=${params.MODE}
set LABEL=${params.LABEL}
set BUILD_VERSION=${params.BUILD_VERSION}
cd deployment\\pyDeployScript
python -m venv venv
venv/Script/activate.bat
pip install xmltodict winrm
py DeployAppTest.py
"""
           }
        }
    }
}